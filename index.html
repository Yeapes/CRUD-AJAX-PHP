<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <title>JQUERY AJAX CRUD</title>
</head>

<body>
    <div class="container">
        <h1 class="text-center text-success">JQUERY AJAX CRUD With PHP Query Builder</h1>
        <button type="submit" class="btn btn-warning add_user">Add User</button>
        <table class="table" id="users_table">




        </table>
    </div>
    <!-- View Modal -->
    <div class="modal fade bd-example-modal-lg" id="dataModal" tabindex="-1" role="dialog"
        aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="user_detail">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Edit Modal -->
    <div class="modal fade bd-example-modal-lg2" id="edit_data_Modal" tabindex="-1" role="dialog"
        aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Update Data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div id="updateError">

                </div>
                <div class="modal-body"> 
                    <form class="form mt-5 contact-form" method="post" id="update_form">
                        <div class="form-group ">
                            <div class="col-sm-12">
                                <input class="form-control form-control-line" type="text" placeholder="Full Name"
                                    id="name" name="fullName">
                            </div>
                        </div>
                        <div class="form-group ">
                            <div class="col-sm-12">
                                <input class="form-control form-control-line" type="email" placeholder="Email"
                                    id="email" name="email" required="required">
                            </div>
                        </div>
                        <div class="form-group ">
                            <div class="col-sm-12">
                                <input class="form-control form-control-line" type="text" placeholder="Phone" id="phone"
                                    name="phone" required="required">
                            </div>
                        </div>
                        <div class="form-group ">
                            <div class="col-sm-12">
                                <input class="form-control form-control-line" type="text" placeholder="City" id="city"
                                    name="city" required="required">
                            </div>
                        </div>
                        <div class="form-group ">
                            <div class="col-sm-12">
                                <label>Date Of Birth</label>
                            </div>
                            <div class="col-sm-12">
                                <input class="form-control form-control-line" type="date" placeholder="Date Of Birth"
                                    id="dob" name="dateOfBirth" required="required">
                            </div>
                        </div>

                        <input type="hidden" name="userId" id="userId">
                        <div class="form-group">
                            <div class="col-sm-12 mt-4">
                                <button class="btn btn-primary btn-block" name="insert" id="insert" value="Insert"
                                    type="submit">Update Data</button>
                            </div>
                        </div>
                    </form>

                </div>
                <div class="modal-footer">
                    <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Add Modal -->
    <div class="modal fade bd-example-modal-lg2" id="add_data_Modal" tabindex="-1" role="dialog"
        aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add User</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div id="addError">

                </div>
                <div class="modal-body"> 
                    <form class="form mt-5 contact-form" method="post" id="add_form">
                        <div class="form-group ">
                            <div class="col-sm-12">
                                <input class="form-control form-control-line" type="text" placeholder="Name"
                                    id="name" name="a_name">
                            </div>
                        </div>
                        <div class="form-group ">
                            <div class="col-sm-12">
                                <input class="form-control form-control-line" type="email" placeholder="Email"
                                    id="email" name="a_email" required="required">
                            </div>
                        </div>
                        <div class="form-group ">
                            <div class="col-sm-12">
                                <input class="form-control form-control-line" type="text" placeholder="Phone" id="phone"
                                    name="a_phone" required="required">
                            </div>
                        </div>
                        <div class="form-group ">
                            <div class="col-sm-12">
                                <input class="form-control form-control-line" type="text" placeholder="City" id="city"
                                    name="a_city" required="required">
                            </div>
                        </div>
                        <div class="form-group ">
                            <div class="col-sm-12">
                                <label>Date Of Birth</label>
                            </div>
                            <div class="col-sm-12">
                                <input class="form-control form-control-line" type="date" placeholder="Date Of Birth"
                                    id="dob" name="a_dob" required="required">
                            </div>
                        </div>

                        <input type="hidden" name="userId" id="userId">
                        <div class="form-group">
                            <div class="col-sm-12 mt-4">
                                <button class="btn btn-primary btn-block" name="insert" id="push_btn" value="Insert"
                                    type="submit">Push User</button>
                            </div>
                        </div>
                    </form>

                </div>
                <div class="modal-footer">
                    <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
     <!-- Delete Modal -->
     <div class="modal fade bd-example-modal-sm" id="delete_modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm To Delete</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Are you sure to delete this data?</p>
                </div>
                <div class="modal-footer">
                    <button id="dlt_btn" type="submit" name="confirm_delete" class="btn btn-primary confirm_delete">Delete</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                </div>
            </div>
        </div>
</div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="js/jquery-min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
    <script>
        //Get Users
        $(document).ready(function () {
            function getUsers() {
                $.ajax(
                    {
                        url: 'getUsers.php',
                        method: 'POST',
                        success: function (response) {
                            $('#users_table').html(response);
                        }
                    }
                );
            }
            getUsers(); 
        //View Single User
        $(document).on('click', '.view', function () {
            var id = $(this).attr('id');
            if (id != '') {
                $.ajax(
                    {
                        url: 'singleView.php',
                        method: 'POST',
                        data: { id: id },
                        success: function (response) {
                            $('#user_detail').html(response);
                            $('#dataModal').modal('show');
                        }
                    }
                );
            }
        });
        //Edit Single User
         $(document).on('click','.edit',function(response) {
             var id = $(this).attr('id');
            if(id !== ''){
                $.ajax(
                    {
                        url: 'singleEdit.php',
                        method: 'POST',
                        dataType: 'json',
                        data: {id:id},
                        success: function(response) {
                            $('#name').val(response.name),
                            $('#email').val(response.email),
                            $('#phone').val(response.phone),
                            $('#city').val(response.city),
                            $('#dob').val(response.dob),
                            $('#userId').val(response.id),
                            $('#edit_data_Modal').modal('show')
                        }
                    }
                );
            }
         });
         //Update Form Data
         $('#update_form').on('submit',function(event) {
             event.preventDefault();
             var name = $('#name').val();
             var email = $('#email').val();
             var phone = $('#phone').val();
             var city = $('#city').val();
             var dob = $('#dob').val();
             var userId = $('#userId').val();
             if(name == ''){
                 alert("Please Type Your Name");
             }else if(email == ''){
                 alert("Please Type Your Email ");
             }else if(phone == ''){
                 alert("Please Type Your Phone");
             }else if(city == ''){
                 alert("Please Type Your City");
             }else if(dob == ''){
                 alert("Please Type Your Date Of Birth");
             }
              $.ajax({
                  url: 'updateUser.php',
                  method: 'POST',
                  data: {
                      id: $('#userId').val(),
                      name: $('#name').val(),
                      email: $('#email').val(),
                      phone: $('#phone').val(),
                      city: $('#city').val(),
                      dob: $('#dob').val() 
                },
                success: function(response) {
                    if(response == 'successfull'){ 
                                $('#update_form')[0].reset(); 
                                getUsers();
                    }
                    $('#edit_data_Modal').modal('hide');
                }
              });
              
         });
         //Show User Modal
         $(document).on('click','.add_user',function() { 
            $('#add_data_Modal').modal('show'); 
         });
         //Push User
         $('#push_btn').on('click',function(event){
             event.preventDefault(); 
                    let name = $("input[name='a_name']").val();
                    let email = $("input[name='a_email']").val();
                    let phone = $("input[name='a_phone']").val();
                    let city = $("input[name='a_city']").val();
                    let dob = $("input[name='a_dob']").val();
                    $.ajax(
                        {
                            url: 'userPush.php',
                            method: 'POST',
                            data: { 
                                name: name,
                                email: email,
                                phone: phone,
                                city: city,
                                dob: dob
                            },
                            success: function(response){
                               if (response == 'success') {
                                    $('#add_form')[0].reset(); 
                                    getUsers();  
                               }
                               $('#add_data_Modal').modal('hide');
                            } 
                        }
                    );
         });
         //Delete Single User
         $(document).on('click','.delete',function(){
             var userId = $(this).attr('id'); 
            $('#delete_modal').modal('show');
            $(document).on('click','.confirm_delete',function(){
                $.ajax({
                    url: 'userDelete.php',
                    method: "POST",
                    data: {id:userId},
                    success: function(response){
                        if (response == 'success') {
                            $('#delete_modal').modal('hide');
                            getUsers();
                        }
                    }

                });
            });
         });
        });

    </script>

</body>

</html>